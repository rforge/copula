## Copyright (C) 2012 Marius Hofert, Ivan Kojadinovic, Martin Maechler, and Jun Yan
##
## This program is free software; you can redistribute it and/or modify it under
## the terms of the GNU General Public License as published by the Free Software
## Foundation; either version 3 of the License, or (at your option) any later
## version.
##
## This program is distributed in the hope that it will be useful, but WITHOUT
## ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
## FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
## details.
##
## You should have received a copy of the GNU General Public License along with
## this program; if not, see <http://www.gnu.org/licenses/>.


useDynLib(copula, .registration=TRUE)


## import all we need, but not more..

importFrom("stats", D, approxfun, cor # 'coef': from "bblme"; 'logLik': from "stats4"
	 , deriv, dnorm, dpois, dt, ecdf, integrate, .lm.fit, median, model.matrix
         , na.omit, nobs
         , optimize, optim, p.adjust.methods, p.adjust
         , pchisq, pgamma, pnorm, ppois, ppoints, printCoefmat, pt
         , qchisq, qgamma, qlogis, qnorm, qqline, qt, quantile
         , rbeta, rbinom, rcauchy, rexp, rgamma, rmultinom, rnorm, runif
         , setNames, splinefun, uniroot
         , var, vcov
           )

importFrom("utils", str, setTxtProgressBar, txtProgressBar, modifyList, head, tail)

importFrom("grDevices", col2rgb, dev.flush, dev.hold, dev.off, pdf, extendrange,
           gray)
importFrom("graphics", Axis, abline, axis, box, contour, curve
         , layout.show, layout, lcm, lines, mtext
         , par, persp, pairs
         , plot.new, plot.window, points
         , rect, rug, strwidth, text
           )

importMethodsFrom("methods", ## those for which we export new methods:
		  coerce, show)
importFrom("methods", as, is, extends, new
         , callGeneric, existsFunction, hasArg, hasMethod, callNextMethod
         , getClass, getClassDef
         , setClass, setClassUnion, setMethod, setOldClass
         , setValidity, validObject, slot, "slot<-", slotNames, .hasSlot
         , signature, representation, prototype)

importFrom("stats4", mle)
importMethodsFrom("stats4",
		  coef, confint, logLik, AIC, BIC,
		  plot, profile, summary)

importFrom("lattice", trellis.par.get, trellis.par.set,
	   splom, wireframe, contourplot, cloud,
           standard.theme, panel.fill, panel.splom, diag.panel.splom)

importFrom("Matrix", nearPD)
## NB: "Dangerous" to not also depend on Matrix; as 'methods' for Matrixclasses are not seen.

importFrom("gsl", debye_1, debye_2, dilog, complex_dilog)

importFrom("ADGofTest", ad.test)# really would want the ad.test.statistic() but that's hidden

importFrom("stabledist", dstable)

## importFrom("bbmle", mle2)


if(FALSE) {## currently do not want to "depend" on Rmpfr's correct installation:
## As we use it only in "numerically hard cases" polyG(), dsumSibuya(),..:
importFrom("Rmpfr",
	   mpfr, chooseMpfr, chooseMpfr.all,
	   getPrec, roundMpfr, sumBinomMpfr)
## currently needed when Rmpfr is detached, as it influences "numeric" (e.g. in examples testing):
importClassesFrom("Rmpfr",
                  mpfr, atomicVector, array_or_vector, Mnumber)
}

importFrom("mvtnorm",
           dmvnorm, pmvnorm, rmvnorm,
           ## rather user should require("mvtnorm") for these: GenzBretz, Miva, TVPACK,
           dmvt, pmvt, rmvt)

importFrom("pcaPP", cor.fk)# Fast Kendall's tau


## FIXME: we would only want importS3MethodsFrom("pspline", predict)
import("pspline")
## S3method(predict, smooth.Pspline)

## importFrom(sn, dmst)
## importFrom(sn, qsn, dsn, psn, dmsn, pmsn)

importFrom("numDeriv", grad, jacobian)


### Part I: Mainly former copula ###############################################

export(dCopula, pCopula, rCopula)
export(cCopula)
export(dMvdc, pMvdc, rMvdc)
export(tau, rho, lambda)
export(iTau, iRho)

## archmCopula methods
export(psi, iPsi, diPsi)

## evCopula methods
export(A, dAdu, An.biv, An)

exportClasses(mvdc)
exportClasses(Copula, parCopula, xcopula, copula, # virtual classes
	      ellipCopula, archmCopula, evCopula)
exportClasses(indepCopula)
exportClasses(normalCopula, tCopula)
exportClasses(claytonCopula, frankCopula, gumbelCopula, amhCopula, joeCopula)
exportClasses(galambosCopula, huslerReissCopula, tawnCopula, tevCopula)
exportClasses(fgmCopula, plackettCopula)

export(mvdc)
export(ellipCopula, archmCopula, evCopula)
export(normalCopula, tCopula)
export(indepCopula)
export(claytonCopula, frankCopula, gumbelCopula, amhCopula, joeCopula)
export(galambosCopula, huslerReissCopula, tawnCopula, tevCopula)
export(plackettCopula)
export(fgmCopula)

## "transformed" copula classes
export(rotCopula)
exportClasses(rotCopula)

export(khoudrajiCopula)
exportClasses(asymCopula, asym2Copula,
              khoudrajiCopula, khoudrajiBivCopula, khoudrajiExplicitCopula)

## auxiliary functions mainly used for working with elliptical copulas:
export(p2P, P2p, getSigma, extremePairs)

exportMethods(show)
exportMethods(persp, contour, plot, contourplot2, wireframe2, cloud2, splom2)

## empirical copula
export(F.n, C.n, dCn)# .Fn

## fitting copula
export(loglikCopula, loglikMvdc)
export(fitCopula, fitMvdc)
exportClasses(fittedMV, fitCopula, fitMvdc)

## some parameters can be fixed ( ./R/fixedPar.R ) :
export(fixParam, "fixedParam<-")


## estimation of tail dependence
export(fitLambda)

## independence tests
export(indepTestSim, indepTest, multIndepTest,
       serialIndepTestSim, serialIndepTest, multSerialIndepTest,
       dependogram)

## gof tests
export(gofCopula, gofMB, gofPB, gofEVCopula)

## cross-validation
export(xvCopula)

## ggraph utils
export(pairwiseCcop, pairwiseIndepTest, pviTest, gpviTest, RSpobs, gofBTstat) # R/ggraph-tools.R
export(pairsColList, pairsRosenblatt, .pairsCond) # R/pairsRosenblatt.R

## other nonparametric tests
export(evTestC, evTestA, evTestK)
export(exchEVTest, exchTest)



S3method(print, copula)
S3method(print, mvdc)
S3method(print, indepTest)
S3method(print, fitCopula)
S3method(summary, fitCopula)
S3method(print, fitMvdc)
S3method(summary, fitMvdc)
##
S3method(coef, fittedMV)
S3method(nobs, fittedMV)
S3method(vcov, fittedMV)
S3method(logLik, fittedMV)

##_TESTING_
## export(dCdtheta, dcdtheta, dTau, dRho)
## export(dCdu)
## export(ChiPlot, KPlot)
##
## export(fitCopula.repar)
## export(multcomp) ---> R/mult.R


### Part II: Mainly former nacopula ############################################

exportClasses("acopula",
              "nacopula", "outer_nacopula",
              "interval", "maybeInterval"
              )

## Generics, functions and acopula - family objects defined in this package
export("copAMH", "copClayton", "copFrank", "copGumbel", "copJoe"
       , .ac.shortNames, .ac.longNames, .ac.objNames, .ac.classNames
       ,"getAcop", "getAname"
       , "dnacopula", "pnacopula", "rnacopula", "rnchild"
       ## estimation
       ,"coeffG" ## , "polyG", "polyJ", "signFF"
       ,"initOpt"
       ,"beta.", "betan", "pobs"
       ,"debye1", "debye2" # <- since we extend the gsl ones
       ,"ebeta", "etau", "emde", "dDiag", "edmle", "emle", "enacopula"
       ## goodness-of-fit
       ,"gofTstat", "htrafo"
       ## distribution of the radial part for Archimedean copulas
       ,"pacR", "qacR"
       ## Kendall distribution
       ,"Kn", "pK", "qK", "dK", "rK"
       ## misc
       ,"onacopula", "onacopulaL", "nac2list", "nesdepth", "rnacModel", "nacPairthetas"
       ,"polynEval"
       ,"printNacopula"
       ,"interval"
       ,"opower"
       ,"prob"
       ,"nacFrail.time"
       ## Should we provide these in a separate (very small) R package ?
       ,"sinc", "A..Z"
       ,"rstable1"
       ,"retstable", "retstableR"
       ,"dSibuya", "pSibuya", "dsumSibuya", "rSibuya", "rSibuyaR"
       ,"rlog", "rlogR", "rF01Frank", "rF01Joe", "rFFrank", "rFJoe"
       ,"log1mexp" ,"log1pexp"
       ,"polylog", "Bernoulli", "Bernoulli.all"
       ,"Eulerian", "Stirling1", "Stirling2"
       ,"Eulerian.all", "Stirling1.all", "Stirling2.all"
       ,"setTheta"
       ,"tauAMH", "tauJoe"
       ,"allComp" # <- maybe keep private ?
       ,"safeUroot"
       ,"pairs2", "splom2", "qqplot2"
       )
## Deprecated (old names) --- move to 'Defunct', i.e., replace .Deprecated(.) by .Defunct()
export(
    ## 2012-08-27 :
    cacopula
    ## 2013-01-08 :
  , Cn
    ## 2014-08-03 :
  , gnacopula
    ## 2016-04-22 :
  , gofMB, gofPB
    ## 2016-06-04 :
  , rtrafo
    ## in CRAN's copula 0.999-14 till mid-2016
  , tailIndex
  , asymCopula
  , asymExplicitCopula
)

## Defunct (from copula 0.999-15,  mid-2016):
export(
    K
  , absdPsiMC
  , beta.hat
  , calibKendallsTau
  , calibSpearmansRho
  , kendallsTau
  , spearmansRho
  , genInv
  , genFun, genFunDer1, genFunDer2
  , Afun
  , AfunDer
  , Anfun
  , dcopula, pcopula, rcopula
  , dmvdc, pmvdc, rmvdc
)

exportMethods(## for both own and "other" generics:
    prob,
    "%in%", dim, format, show,
    ## from "graphics"
    persp, contour,
    ## imported from "stats4" / "bbmle":
    coef, confint, logLik, #-> hence AIC works [BIC: needs 'nobs' fix in bbmle]
    plot, profile, summary
)
